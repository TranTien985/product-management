extends ../../layouts/default.pug
include ../../mixins/box-head.pug

block main
  .container.my-3
    if (cartDetail.products.length > 0)
      form(
        action="/checkout/order"
        method="POST"
        class="checkout-form"
      )
        .row
          .col-lg-7
            h4.mb-3 THÔNG TIN THANH TOÁN
            
            //- Họ và tên
            .mb-3
              label(for="fullName" class="form-label") Họ và tên *
              input(
                type="text"
                class="form-control"
                id="fullName"
                name="fullName"
                placeholder="Nhập họ và tên"
                required
              )
              
            //- Hàng chứa Số điện thoại và Email
            .row
              .col-md-6.mb-3
                label(for="phone" class="form-label") Số điện thoại *
                input(
                  type="text"
                  class="form-control"
                  id="phone"
                  name="phone"
                  placeholder="Nhập số điện thoại"
                  required
                )
              .col-md-6.mb-3
                label(for="email" class="form-label") Địa chỉ Email
                input(
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  placeholder="Nhập địa chỉ Email"
                )
            
            //- Hàng chứa Tỉnh/Thành, Quận/Huyện, Xã/Phường
            .row
              .col-md-4.mb-3
                label(for="province" class="form-label") Tỉnh/Thành phố *
                select(class="form-select", id="province", name="province", required)
                  option(value="") -- Chọn tỉnh/thành phố --
              .col-md-4.mb-3
                label(for="district" class="form-label") Quận/Huyện *
                select(class="form-select", id="district", name="district", required)
                  option(value="") -- Chọn quận/huyện --
              .col-md-4.mb-3
                label(for="ward" class="form-label") Xã/Phường *
                select(class="form-select", id="ward", name="ward", required)
                  option(value="") -- Chọn xã/phường --
            
            //- Địa chỉ nhà
            .mb-3
              label(for="address" class="form-label") Địa chỉ nhà, tên đường *
              input(
                type="text"
                class="form-control"
                id="address"
                name="address"
                placeholder="Số nhà, tên đường, khu vực..."
                required
              )
            
            //- Ghi chú
            .mb-3
              label(for="note" class="form-label") Ghi chú đơn hàng (tuỳ chọn)
              textarea(
                class="form-control"
                id="note"
                name="note"
                rows="4"
                placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay địa điểm giao hàng."
              )

          //- --- CỘT PHẢI: ĐƠN HÀNG CỦA BẠN ---
          .col-lg-5
            // Box tóm tắt
            .checkout-summary
              h4.mb-3 ĐƠN HÀNG CỦA BẠN
              
              //- 1. Danh sách sản phẩm 
              .checkout-product-list
                each item in cartDetail.products
                  .checkout-product-item
                    span.checkout-product-name 
                      | #{item.productInfo.title} 
                      strong  x #{item.quantity}
                    strong.checkout-product-subtotal #{item.totalPrice.toLocaleString('vi-VN')} ₫
              
              //- 2. Tóm tắt tổng (thay thế <h3> cũ)
              .summary-section
                .summary-line
                  span Tạm tính
                  strong #{cartDetail.totalPrice.toLocaleString('vi-VN')} ₫
                  
                .summary-line
                  span Vận chuyển
                  span.small Phí giao hàng sẽ được tính theo đơn vị vận chuyển thực tế. Chúng tôi sẽ báo cho bạn trước khi giao hàng. Đơn hàng trên 2tr sẽ được miễn phí giao hàng.
                
                //- Tổng cộng cuối cùng
                .summary-line.summary-total
                  strong Tổng cộng
                  strong.total-price #{cartDetail.totalPrice.toLocaleString('vi-VN')} ₫
                  
              //- 3. Nút Đặt Hàng
              button(
                type="submit"
                class="btn btn-warning w-100 fw-bold fs-5 btn-place-order"
              ) ĐẶT HÀNG
              
              p.small.text-muted.mt-2
                | Thông tin của bạn sẽ được dùng để xử lý đơn hàng...

    else
      .col-12
        p Giỏ hàng của bạn đang trống.
        a(href="/products", class="btn btn-primary") Quay lại cửa hàng

  script(src="/js/checkout.js") 