extends ../../layouts/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/search-text.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/show-alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug


block main 
  +alert-success(5000)
  +alert-error(5000)

  h1 Danh Sách Tin Tức

  .card.mb-3 
    .card-header Bộ lọc 
    .card-body
      .row 
        .col-3
          //- sử dụng mixins
          +sort()

        .col-9
          +fiter-status(filterStatus)
  
  .card.mb-3 
    .card-header Tìm kiếm 
    .card-body 
      .row
        .col-6
          +search-text(keyword, listCategories, categoryId)

  .card.mb-3 
    .card-header Danh Sách
      .card-body
        .row 
          .col-8 
            +form-change-multi(`${prefixAdmin}/news/change-multi?_method=PATCH`)
          .col-4.text-right  
            if(role.permissions.includes("news_create"))
              a(
                href=`${prefixAdmin}/news/create`
                class="btn btn-outline-success "
              ) + Thêm mới
        
        table(
          class="table table-hover align-middle"
          checkbox-multi
        )
          thead 
            tr 
              th 
                input(type="checkbox" name="checkall")
              th STT 
              th Hình ảnh 
              th Tiêu đề
              th Vị trí 
              th Trạng thái 
              th Người tạo  
              th Người cập nhật 
              th Hành động

          tbody
            each item,index in news
              tr
                td 
                  input(
                    type="checkbox"
                    name="id"
                    value=item.id 
                  )
                td #{pagination.limitItems*(pagination.currentPage - 1) + (index + 1)}
                td 
                  img(
                    src=item.thumbnail, 
                    alt=item.title
                    width ="100px"
                    height="auto"
                  )
                td(width ="500px") #{item.title}
                td 
                  input(
                    type="number"
                    value=item.position 
                    name="position"
                    min="1"
                    style="width: 60px"
                  )
                td
                  if(role.permissions.includes("news_edit"))
                    if(item.availabilityStatus == "In Stock")
                      //- "javascript:;" chức năng của thẻ a bây giờ sẽ được biểu diễn trong file js
                      a(
                        href="javascript:;"
                        data-status=item.availabilityStatus
                        data-id=item.id 
                        button-change-status 
                        class="badge badge-success"
                      ) Hoạt động 
                    else 
                      a(
                        href="javascript:;"
                        data-status=item.availabilityStatus
                        data-id=item.id 
                        button-change-status 
                        class="badge badge-danger"
                      ) Dừng hoạt động
                  else 
                    if(item.availabilityStatus == "In Stock")
                      a(
                        data-status=item.availabilityStatus
                        data-id=item.id 
                        class="badge badge-success"
                      ) Hoạt động 
                    else 
                      a(
                        data-status=item.availabilityStatus
                        data-id=item.id 
                        class="badge badge-danger"
                      ) Dừng hoạt động
                td 
                  p #{item.accountFullName} 
                  p 
                    +formatDateTime(item.createdBy.createdAt)
                td
                  - const updatedBy = item.updatedBy.slice(-1)[0];
                  if(updatedBy)
                    p #{updatedBy.accountFullName} 
                    p 
                      +formatDateTime(updatedBy.updatedAt)
                td 
                  a(
                    href=`${prefixAdmin}/news/detail/${item.id}`
                    class="btn btn-secondary btn-sm"
                  ) Chi tiết
                  if(role.permissions.includes("news_edit"))
                    a(
                      href=`${prefixAdmin}/news/edit/${item.id}`
                      class="btn btn-warning btn-sm"
                      button-edit
                    ) Sửa
                  if(role.permissions.includes("news_delete"))
                    button(
                      class="btn btn-danger btn-sm ml-1"
                      button-delete
                      data-id=item.id
                    ) Xóa
  
  //- 1h25 bài 21 phân trang
  +pagination(pagination)
  
  //- mục đích để tạo form này để khi submit
    nó sẽ gửi lên cái form có đường dẫn trong phần action
  form(
    action=""  
    method="POST"
    id="form-change-status"
    data-path=`${prefixAdmin}/news/change-status`
  ) 

  form(
    action="" 
    method="POST"
    id="form-delete-item"
    data-path=`${prefixAdmin}/news/delete`
  ) 

  script(src="/admin/js/product.js") 