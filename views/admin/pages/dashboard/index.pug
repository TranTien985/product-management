extends ../../layouts/default.pug

block main
  //- HÀNG CHÍNH CHỨA TOÀN BỘ NỘI DUNG
  .row
    .col-xl-4.col-lg-5.mb-4
      .card.shadow.border-0.h-100
        .card-header.bg-white.border-bottom-0.pt-4.pb-0
          h5.mb-0.font-weight-bold.text-gray-800 
            <i class="fa-solid fa-user-tie mr-2"></i> Hồ sơ cá nhân
        
        .card-body
          .text-center.mt-3.mb-4
            if(user.avatar)
              img.rounded-circle.shadow-sm(src=user.avatar style="width: 120px; height: 120px; object-fit: cover; border: 4px solid #fff;")
            else
              img.rounded-circle.shadow-sm(src="/admin/images/avatar-default.png" style="width: 120px; height: 120px; object-fit: cover; border: 4px solid #fff;")
            
            h4.mt-3.mb-1.font-weight-bold.text-dark #{user.fullName}
            span.badge.badge-primary.px-3.py-2.rounded-pill #{role.title}

          .border-top.pt-3
            .d-flex.justify-content-between.mb-2
              strong.text-muted Email:
              span #{user.email}
            .d-flex.justify-content-between.mb-2
              strong.text-muted Số điện thoại:
              span #{user.phone ? user.phone : '---'}
            .d-flex.justify-content-between
              strong.text-muted Trạng thái:
              span.text-success <i class="fa-solid fa-circle text-xs"></i> Đang hoạt động

    .col-xl-8.col-lg-7
      .row
        //- Card 1: DANH MỤC SẢN PHẨM
        .col-md-6.mb-4
          .card.border-left-primary.shadow.h-100.py-2
            .card-body
              .row.no-gutters.align-items-center
                .col.mr-2
                  .text-xs.font-weight-bold.text-primary.text-uppercase.mb-2 Danh mục
                  .h5.mb-0.font-weight-bold.text-gray-800 #{statistic.categoryProduct.total}
                  .mt-2.small
                    span.text-success.mr-2 <i class="fa-solid fa-check"></i> Hoạt động #{statistic.categoryProduct.active}
                    span.text-danger <i class="fa-solid fa-triangle-exclamation"></i>Dừng hoạt động #{statistic.categoryProduct.inactive}

        //- Card 2: SẢN PHẨM
        .col-md-6.mb-4
          .card.border-left-warning.shadow.h-100.py-2
            .card-body
              .row.no-gutters.align-items-center
                .col.mr-2
                  .text-xs.font-weight-bold.text-warning.text-uppercase.mb-2 Sản phẩm
                  .h5.mb-0.font-weight-bold.text-gray-800 #{statistic.product.total}
                  .mt-2.small
                    span.text-success.mr-2 <i class="fa-solid fa-check"></i>Hoạt động #{statistic.product.active}
                    span.text-danger <i class="fa-solid fa-triangle-exclamation"></i>Dừng hoạt động #{statistic.product.inactive}

        //- Card 3: ĐƠN HÀNG
        .col-md-6.mb-4
          .card.border-left-success.shadow.h-100.py-2
            .card-body
              .row.no-gutters.align-items-center
                .col.mr-2
                  .text-xs.font-weight-bold.text-success.text-uppercase.mb-2 Đơn hàng
                  .h4.mb-0.font-weight-bold.text-gray-800 #{statistic.order.total}
                  .mt-2.small
                    span.text-success.mr-2 <i class="fa-solid fa-truck"></i>Đang giao #{statistic.order.active}
                    span.text-danger <i class="fa-solid fa-xmark"></i>Đã hủy #{statistic.order.inactive}

        //- Card 4: KHÁCH HÀNG
        .col-md-6.mb-4
          .card.border-left-info.shadow.h-100.py-2
            .card-body
              .row.no-gutters.align-items-center
                .col.mr-2
                  .text-xs.font-weight-bold.text-info.text-uppercase.mb-2 Khách hàng
                  .h4.mb-0.font-weight-bold.text-gray-800 #{statistic.user.total}
                  .mt-2.small
                    span.text-success.mr-2 <i class="fa-solid fa-user-check"></i>Hoạt động #{statistic.user.active}
                    span.text-secondary <i class="fa-solid fa-user-lock"></i>Khóa #{statistic.user.inactive}
  
  .row.mt-4
    //- ĐƠN HÀNG MỚI 
    .col-xl-7.col-lg-6
      .card.shadow.mb-4
        .card-header.py-3.d-flex.flex-row.align-items-center.justify-content-between
          h6.m-0.font-weight-bold.text-primary Đơn hàng mới nhập
          a.small.text-decoration-none(href=`${prefixAdmin}/orders`) Xem tất cả
        
        .card-body
          if(recentOrders.length > 0)
            .table-responsive
              table.table.table-bordered.table-hover.mb-0
                thead.thead-light
                  tr
                    th Mã đơn
                    th Khách hàng
                    th Tổng tiền
                    th Trạng thái
                tbody
                  each item in recentOrders
                    tr
                      td 
                        strong ##{item.orderCode} 
                        //- (Chỉ hiện 4 ký tự cuối của ID cho gọn)
                      td #{ item.shippingAddress.fullName }
                      td 
                        //- Giả sử bạn có trường totalPrice, nhớ format tiền tệ
                        | #{item.totalPrice ? item.totalPrice.toLocaleString() : 0}đ
                      td 
                        if(item.orderStatus === "Delivered")
                          span.badge.badge-success Đã giao
                        else if(item.orderStatus === "Cancelled")
                          span.badge.badge-danger Đã hủy
                        else
                          span.badge.badge-warning Chờ xử lý
          else
             p.text-center.text-muted.my-3 Chưa có đơn hàng nào.

    //- SẢN PHẨM BÁN CHẠY (Top Selling)
    .col-xl-5.col-lg-6
      .card.shadow.mb-4
        .card-header.py-3
          h6.m-0.font-weight-bold.text-primary Top sản phẩm bán chạy
        
        .card-body
          if(topSellingProducts.length > 0)
            .table-responsive
              table.table.table-borderless.mb-0
                thead.text-muted(style="font-size: 0.85rem;")
                  tr
                    th Sản phẩm
                    th.text-center Đã bán
                    th.text-right Doanh thu
                tbody
                  each item in topSellingProducts
                    tr.border-bottom
                      td
                        .d-flex.align-items-center
                          if(item.thumbnail)
                            img.rounded.mr-2(src=item.thumbnail width="40" height="40" style="object-fit: cover")
                          div
                            a.font-weight-bold.d-block(
                              href=`${prefixAdmin}/products/detail/${item._id}`
                              style="font-size: 0.9rem; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-decoration: none"
                              title=item.title
                            ) #{item.title}
                            small.text-muted #{item.price ? item.price.toLocaleString() : 0}đ
                      
                      td.text-center.align-middle
                         //- Sử dụng trường quantity_sold có sẵn trong DB
                         span.badge.badge-success.badge-pill #{item.quantity_sold}
                      
                      td.text-right.align-middle.font-weight-bold
                         //- Tính doanh thu: Giá x quantity_sold
                         | #{(item.price * item.quantity_sold).toLocaleString()}đ
          else
             p.text-center.text-muted.my-4 Chưa có dữ liệu bán hàng.